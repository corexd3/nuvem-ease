(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[577],{489:(e,r,s)=>{"use strict";s.d(r,{b:()=>l});var t=s(2115),a=s(7602),n=s(5155),i=t.forwardRef((e,r)=>(0,n.jsx)(a.sG.label,{...e,ref:r,onMouseDown:r=>{var s;r.target.closest("button, input, select, textarea")||(null==(s=e.onMouseDown)||s.call(e,r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));i.displayName="Label";var l=i},1647:(e,r,s)=>{"use strict";s.d(r,{E:()=>l});var t=s(5155);s(2115);var a=s(3101),n=s(4269);let i=(0,a.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:r,variant:s,...a}=e;return(0,t.jsx)("div",{className:(0,n.cn)(i({variant:s}),r),...a})}},5142:(e,r,s)=>{"use strict";s.d(r,{p:()=>i});var t=s(5155),a=s(2115),n=s(4269);let i=a.forwardRef((e,r)=>{let{className:s,type:a,...i}=e;return(0,t.jsx)("input",{type:a,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:r,...i})});i.displayName="Input"},5184:(e,r,s)=>{Promise.resolve().then(s.bind(s,9929))},5299:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});let t=(0,s(1847).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},6444:(e,r,s)=>{"use strict";s.d(r,{J:()=>c});var t=s(5155),a=s(2115),n=s(489),i=s(3101),l=s(4269);let d=(0,i.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)(n.b,{ref:r,className:(0,l.cn)(d(),s),...a})});c.displayName=n.b.displayName},9929:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>E});var t=s(5155),a=s(2115),n=s(63),i=s(4585),l=s(9253),d=s(9708),c=s(9750),o=s(1871),u=s(3998),m=s(5142),x=s(6444),f=s(4269);let v=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("textarea",{className:(0,f.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:r,...a})});v.displayName="Textarea";var h=s(6948);let p=(0,s(3101).F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),g=a.forwardRef((e,r)=>{let{className:s,variant:a,...n}=e;return(0,t.jsx)("div",{ref:r,role:"alert",className:(0,f.cn)(p({variant:a}),s),...n})});g.displayName="Alert",a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("h5",{ref:r,className:(0,f.cn)("mb-1 font-medium leading-none tracking-tight",s),...a})}).displayName="AlertTitle";let b=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("div",{ref:r,className:(0,f.cn)("text-sm [&_p]:leading-relaxed",s),...a})});b.displayName="AlertDescription";var j=s(1647),N=s(5894),y=s(5299),w=s(6651),k=s(8874);let C=(0,s(1847).A)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);function E(){let e=(0,n.useRouter)(),{toast:r}=(0,N.dj)(),[s,f]=(0,a.useState)(null),[p,E]=(0,a.useState)(!1),[_,R]=(0,a.useState)(!1),[A,F]=(0,a.useState)(null),[S,B]=(0,a.useState)(""),[I,M]=(0,a.useState)("");(0,a.useEffect)(()=>{let r=(0,l.hg)(i.j2,r=>{if(!r)return void e.push("/auth");f(r)});return()=>r()},[e]);let T=async()=>{if(!S.trim())return void r({title:"Error",description:"Please enter an invoice number",variant:"destructive"});R(!0);try{let e=(0,d.rJ)(i.db,"invoices"),t=(0,d.P)(e,(0,d._M)("user_id","==",s.uid),(0,d._M)("numero","==",S)),a=await (0,d.GG)(t);if(a.empty)r({title:"Not Found",description:"Invoice not found",variant:"destructive"}),F(null);else{let e=a.docs[0];F({id:e.id,...e.data()})}}catch(e){r({title:"Error",description:e.message,variant:"destructive"})}finally{R(!1)}},Z=async()=>{if(!I.trim())return void r({title:"Error",description:"Please provide a cancellation reason",variant:"destructive"});if(I.length<15)return void r({title:"Error",description:"Cancellation reason must be at least 15 characters",variant:"destructive"});E(!0);try{let e=(0,d.H9)(i.db,"invoices",A.id);await (0,d.mZ)(e,{status:"cancelled",cancellation_reason:I,cancelled_at:(0,d.O5)(),updated_at:(0,d.O5)()}),r({title:"Success",description:"Invoice cancelled successfully"}),F(null),B(""),M("")}catch(e){r({title:"Error",description:e.message,variant:"destructive"})}finally{E(!1)}};return s?(0,t.jsxs)("div",{className:"min-h-screen flex flex-col",children:[(0,t.jsx)(c.F,{user:s}),(0,t.jsxs)("div",{className:"flex flex-1",children:[(0,t.jsx)(o.B,{}),(0,t.jsx)("main",{className:"flex-1 p-8 bg-background",children:(0,t.jsxs)("div",{className:"max-w-3xl mx-auto space-y-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"Cancel NFC-e"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-2",children:"Cancel an existing invoice"})]}),(0,t.jsxs)(h.Zp,{children:[(0,t.jsxs)(h.aR,{children:[(0,t.jsx)(h.ZB,{children:"Find Invoice"}),(0,t.jsx)(h.BT,{children:"Enter the invoice number to cancel"})]}),(0,t.jsx)(h.Wu,{className:"space-y-4",children:(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,t.jsx)(x.J,{htmlFor:"invoice-number",children:"Invoice Number"}),(0,t.jsx)(m.p,{id:"invoice-number",placeholder:"Enter invoice number...",value:S,onChange:e=>B(e.target.value),onKeyDown:e=>"Enter"===e.key&&T()})]}),(0,t.jsx)("div",{className:"flex items-end",children:(0,t.jsxs)(u.$,{onClick:T,disabled:_,children:[_?(0,t.jsx)(y.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,t.jsx)(w.A,{className:"mr-2 h-4 w-4"}),"Search"]})})]})})]}),A&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h.Zp,{children:[(0,t.jsx)(h.aR,{children:(0,t.jsx)(h.ZB,{children:"Invoice Details"})}),(0,t.jsxs)(h.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Number"}),(0,t.jsx)("p",{className:"font-medium",children:A.numero})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Status"}),(0,t.jsx)(j.E,{variant:"cancelled"===A.status?"destructive":"authorized"===A.status?"default":"outline",children:A.status})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Customer"}),(0,t.jsx)("p",{className:"font-medium",children:A.customer_name||"â€”"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Value"}),(0,t.jsx)("p",{className:"font-medium",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(A.total_value))})]})]}),"cancelled"===A.status&&(0,t.jsxs)(g,{variant:"destructive",children:[(0,t.jsx)(k.A,{className:"h-4 w-4"}),(0,t.jsx)(b,{children:"This invoice is already cancelled"})]}),"pending"===A.status&&(0,t.jsxs)(g,{children:[(0,t.jsx)(C,{className:"h-4 w-4"}),(0,t.jsx)(b,{children:"This invoice is still pending and hasn't been authorized yet"})]})]})]}),"cancelled"!==A.status&&(0,t.jsxs)(h.Zp,{children:[(0,t.jsxs)(h.aR,{children:[(0,t.jsx)(h.ZB,{children:"Cancellation"}),(0,t.jsx)(h.BT,{children:"Provide a reason for cancellation"})]}),(0,t.jsxs)(h.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(x.J,{htmlFor:"reason",children:"Cancellation Reason *"}),(0,t.jsx)(v,{id:"reason",placeholder:"Explain why this invoice is being cancelled (minimum 15 characters)...",value:I,onChange:e=>M(e.target.value),rows:4,minLength:15}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[I.length," / 15 characters minimum"]})]}),(0,t.jsxs)(u.$,{onClick:Z,disabled:p||I.length<15,variant:"destructive",className:"w-full",children:[p?(0,t.jsx)(y.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,t.jsx)(k.A,{className:"mr-2 h-4 w-4"}),"Cancel Invoice"]})]})]})]})]})})]})]}):null}}},e=>{e.O(0,[992,138,545,246,525,279,619,952,849,441,255,358],()=>e(e.s=5184)),_N_E=e.O()}]);